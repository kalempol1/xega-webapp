<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Xega Tap ‚Äî Web App</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root{
    --bg:#0d0d12; --card:#14141d; --red:#ff2b4a; --muted:#9aa0aa; --white:#fff;
    --shadow:0 10px 30px rgba(255,43,74,0.25);
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:var(--bg); color:var(--white);
    font: 500 16px/1.5 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;
  }
  .wrap{
    max-width:480px; margin:0 auto; padding:18px 16px 48px;
  }
  .brand{
    display:flex; align-items:center; gap:12px; margin-bottom:16px;
  }
  .dot{width:14px;height:14px;border-radius:50%;background:var(--red);box-shadow:0 0 12px var(--red)}
  h1{font-size:20px;margin:0}
  .card{
    background:linear-gradient(180deg,rgba(255,43,74,0.12),transparent),
               var(--card);
    border:1px solid rgba(255,255,255,0.06);
    border-radius:18px; padding:16px; box-shadow:var(--shadow);
  }
  .row{display:flex;justify-content:space-between;gap:12px;align-items:center}
  .muted{color:var(--muted)}
  .bar{
    height:12px;border-radius:10px;background:#1e1e28;overflow:hidden;margin:8px 0 4px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.06);
  }
  .fill{
    height:100%; background: linear-gradient(90deg,#ff2b4a,#ff6b6b);
    width:0%;
    transition: width .35s ease;
  }
  .stat{display:flex;gap:8px;align-items:center;font-weight:600}
  .pill{
    display:inline-flex;align-items:center;gap:8px;
    padding:10px 14px;border-radius:99px;background:#191922;border:1px solid rgba(255,255,255,0.08)
  }
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:14px}
  button{
    width:100%; padding:14px 16px; border-radius:14px; border:none; color:#fff;
    background:linear-gradient(180deg,#ff2b4a,#cc1130);
    font-weight:800; letter-spacing:0.3px; cursor:pointer;
    box-shadow:var(--shadow); transform:translateZ(0);
  }
  button:active{transform:scale(0.98)}
  .tap-btn{font-size:18px}
  .crit{animation:crit .6s ease}
  @keyframes crit{
    0%{transform:scale(1)}
    30%{transform:scale(1.12)}
    100%{transform:scale(1)}
  }
  .floating{
    position:absolute; left:50%; transform:translateX(-50%);
    color:#fff; font-weight:900; text-shadow:0 2px 10px rgba(0,0,0,.6);
    animation:floatUp .8s ease forwards;
    pointer-events:none;
  }
  @keyframes floatUp{
    from{opacity:0; top:50%}
    to{opacity:1; top:30%}
  }
  .footer{margin-top:16px; text-align:center}
  a{color:#ff5c76; text-decoration:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="brand">
    <div class="dot"></div>
    <h1>üü• Xega Tap</h1>
  </div>

  <div class="card">
    <div class="row">
      <div class="stat">‚≠ê Level <span id="level">1</span></div>
      <div class="muted" id="cooldown">CD: 5s</div>
    </div>
    <div class="bar"><div class="fill" id="bar"></div></div>
    <div class="row muted"><div>XP <b id="xp">0</b></div><div>Multi x<b id="multi">1</b></div></div>

    <div style="margin:14px 0 0; position:relative; height:80px;">
      <button class="tap-btn" id="tapBtn">üî• TAP</button>
      <div id="float"></div>
    </div>

    <div class="grid">
      <button id="btnPoints">üèÖ Points</button>
      <button id="btnShop">üõí Shop</button>
    </div>
  </div>

  <div class="footer muted">
    Channel <a href="http://t.me/XegaChannel" target="_blank">@XegaChannel</a> ‚Ä¢
    Group <a href="http://t.me/XegaCommunity" target="_blank">@XegaCommunity</a>
  </div>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready(); tg.expand(); tg.enableClosingConfirmation();

  // Try to pick Telegram theme color
  document.documentElement.style.setProperty('--bg', tg.backgroundColor || '#0d0d12');

  // Local UI state (client-side preview). Actual XP/upgrade server-side.
  let xp=0, level=1, into=0, need=100, multi=1, cd=5, lastTap=0;

  function updateBar(){
    document.getElementById('xp').textContent = xp;
    document.getElementById('level').textContent = level;
    document.getElementById('multi').textContent = multi;
    document.getElementById('cooldown').textContent = 'CD: '+cd+'s';
    const ratio = Math.max(0, Math.min(1, need? into/need : 0));
    document.getElementById('bar').style.width = (ratio*100).toFixed(1)+'%';
  }
  updateBar();

  function levelCheck(){
    while(into >= need){
      into -= need;
      level += 1;
      need += 100;
    }
  }

  function floatText(txt){
    const el = document.createElement('div');
    el.className='floating';
    el.textContent = txt;
    document.getElementById('float').appendChild(el);
    setTimeout(()=> el.remove(), 900);
  }

  function tapLocal(){
    const base = Math.floor(Math.random()*3)+1; // 1~3
    const crit = Math.random() < 0.12;
    const gain = (crit ? base*2 : base) * multi;
    xp += gain; into += gain;
    levelCheck(); updateBar();
    floatText((crit?'CRIT! +':'+')+gain+' XP');
    const btn = document.getElementById('tapBtn');
    btn.classList.remove('crit'); void btn.offsetWidth; btn.classList.add('crit');
  }

  // Cooldown gate on client (visual). Server de ayrƒ±ca kontrol eder.
  function canTap(){
    const t = Date.now();
    return (t - lastTap) >= cd*1000;
  }

  document.getElementById('tapBtn').addEventListener('click', ()=>{
    if(!canTap()){
      tg.HapticFeedback.notificationOccurred('warning');
      return tg.showPopup({title:'Wait', message:`Cooldown ${cd}s`, buttons:[{type:'close'}]});
    }
    lastTap = Date.now();
    tapLocal(); // g√∂rsel anƒ±nda
    tg.HapticFeedback.impactOccurred('medium');
    // Server‚Äôa bildir
    tg.sendData(JSON.stringify({type:'tap'}));
  });

  document.getElementById('btnPoints').addEventListener('click', ()=>{
    tg.sendData(JSON.stringify({type:'points'}));
    tg.showPopup({title:'Points', message:'Sent request to bot.\nCheck chat for response.', buttons:[{type:'close'}]});
  });

  document.getElementById('btnShop').addEventListener('click', ()=>{
    tg.showPopup({
      title:'Shop',
      message:'Buy upgrade:\n\n1) Multiplier x+1 (500 XP)\n2) Speed CD‚Üí3s (800 XP)',
      buttons:[
        {id:'multi', type:'default', text:'Buy Multiplier'},
        {id:'speed', type:'default', text:'Buy Speed'},
        {type:'cancel'}
      ]
    }, (btnId)=>{
      if(btnId==='multi'){ tg.sendData(JSON.stringify({type:'buy', item:'multi'})); }
      if(btnId==='speed'){ tg.sendData(JSON.stringify({type:'buy', item:'speed'})); cd=3; updateBar(); }
    });
  });
</script>
</body>
</html>
